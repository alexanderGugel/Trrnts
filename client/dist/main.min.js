/*! Trrnts 17-07-2014 */

angular.module("trrntsApp",["ui.router","trrntsApp.main"]).config(["$stateProvider",function(a){a.state("trrntsApp",{template:"<ui-view></ui-view>"})}]).run(["$state",function(a){a.transitionTo("trrntsApp.main")}]),angular.module("trrntsApp.controllers",[]).controller("SubmitMagnetLinkController",["$scope","MagnetLinksFactory",function(a,b){a.magnetURI="",a.submit=function(){a.magnetURI&&b.create(a.magnetURI).catch(function(a){console.error(a)})}}]).controller("LatestMagnetLinksController",["$scope","MagnetLinksFactory",function(a,b){a.perPage=10,a.start=1,a.stop=a.start+a.perPage-1,a.hasPrev=function(){return a.start>1},a.hasNext=function(){return!0},a.latest=[];var c=function(){b.latest(a.start,a.stop).then(function(b){a.latest=b.data}).catch(function(){a.latest=[]})};c(),a.next=function(){a.start+=a.perPage,a.stop+=a.perPage,c()},a.prev=function(){a.start-=a.perPage,a.stop-=a.perPage,c()}}]).controller("TopMagnetLinksController",["$scope","MagnetLinksFactory",function(a,b){a.perPage=10,a.start=1,a.stop=a.start+a.perPage-1,a.top=[],a.hasPrev=function(){return a.start>1},a.hasNext=function(){return a.top.length===a.perPage};var c=function(){b.top(a.start,a.stop).then(function(b){a.top=b.data}).catch(function(){a.top=[]})};c(),a.next=function(){a.start+=a.perPage,a.stop+=a.perPage,c()},a.prev=function(){a.start-=a.perPage,a.stop-=a.perPage,c()}}]).controller("SearchMagnetLinksController",["$scope","MagnetLinksFactory",function(a,b){a.search="",a.searchResults=[],a.perPage=10,a.start=1,a.stop=a.start+a.perPage-1,a.hasPrev=function(){return a.start>1},a.hasNext=function(){return a.searchResults.length===a.perPage};var c=function(){b.search(a.search,a.start,a.stop).then(function(b){a.searchResults=b.data}).catch(function(){a.searchResults=[]})};a.next=function(){a.start+=a.perPage,a.stop+=a.perPage,c()},a.prev=function(){a.start-=a.perPage,a.stop-=a.perPage,c()},a.submit=function(){c()}}]).controller("WorldMapController",["$scope",function(){}]),angular.module("trrntsApp.directives",[]).directive("barChart",function(){return{restrict:"A",link:function(a,b,c){b=b[0];var d=c.barWidth||20,e=c.barSpace||1,f=c.barChartHeight||70,g=c.highlightHeightDiff||20,h=a.magnet.peers||{},i=d3.select(b),j=[];for(var k in h)j.push({peers:parseInt(h[k]),t:1e3*parseInt(k)});h=j;var l=d3.scale.linear().domain([0,d3.max(h,function(a){return a.peers})]).range([0,f-g]),m=d3.tip().attr("class","d3-tip").offset([-g-10,0]).html(function(a){return"<strong>"+a.peers+"</strong> peers <span>"+moment(parseInt(a.t)).fromNow()+" ago</span>"});i.call(m);var n=d3.select(b).selectAll("rect").data(h);n.enter().append("rect").attr("class","bar").attr("width",d).attr("x",function(a,b){return d*b+e*b}).attr("y",f).attr("height",0).transition().duration(300).ease("elastic").delay(function(a,b){return.7*b*30}).attr("y",function(a){return f-l(a.peers)}).attr("height",function(a){return l(a.peers)}),n.on("mouseover",function(a,b){n.filter(function(a,c){return c===b}).transition().ease("elastic").attr("y",function(){return f-l(a.peers)-g}).attr("height",function(){return l(a.peers)+g});m.show(a)}),n.on("mouseleave",function(a,b){n.filter(function(a,c){return c===b}).transition().ease("elastic").attr("y",function(a){return f-l(a.peers)}).attr("height",function(a){return l(a.peers)});m.hide(a)})}}}).directive("worldMap",function(){return{restrict:"A",link:function(a,b){var c=function(){for(var a=[],b=[[49.45045869,-65.15636998],[37.12726948,-17.72583572],[1.16322135,127.68441455],[-25.38805351,88.82525081],[-30.31687802,25.57883445],[-26.46000555,-134.44309036],[-33.52151968,-82.46394689],[-24.96600279,-90.20244849],[-70.94843404,-146.08284954],[-27.03729112,36.61236272]],c=0;c<b.length;c++){var d={radius:Math.floor(50*Math.random()),fillKey:"torrents"};d.latitude=b[c][0],d.longitude=b[c][1],a.push(d)}return a},d=new Datamap({element:b[0],fills:{defaultFill:"#ccc",torrents:"#222"}}),e=c();d.bubbles(e)}}}),angular.module("trrntsApp.filters",[]).filter("agoFilter",function(){return function(a){return a=parseInt(a),moment(a).fromNow()+" ago"}}),angular.module("trrntsApp.main",["trrntsApp.controllers","trrntsApp.services","trrntsApp.directives","trrntsApp.filters"]).config(["$stateProvider",function(a){a.state("trrntsApp.main",{url:"/",views:{"":{templateUrl:"views/main.tpl.html"},"submitMagnet@trrntsApp.main":{templateUrl:"views/submitMagnet.tpl.html",controller:"SubmitMagnetLinkController"},"topMagnets@trrntsApp.main":{templateUrl:"views/topMagnets.tpl.html",controller:"TopMagnetLinksController"},"latestMagnets@trrntsApp.main":{templateUrl:"views/latestMagnets.tpl.html",controller:"LatestMagnetLinksController"},"searchMagnets@trrntsApp.main":{templateUrl:"views/searchMagnets.tpl.html",controller:"SearchMagnetLinksController"},"worldMap@trrntsApp.main":{templateUrl:"views/worldMap.tpl.html",controller:"WorldMapController"}}})}]),angular.module("trrntsApp.services",[]).factory("MagnetLinksFactory",["$http",function(a){var b=function(b){return a({method:"POST",url:"/api/magnets",data:{magnetURI:b}})},c=function(b,c){return a({method:"GET",url:"api/magnets/latest",params:{start:b||1,stop:c||30}})},d=function(b,c){return a({method:"GET",url:"api/magnets/top",params:{start:b||1,stop:c||30}})},e=function(b,c,d){return b||"string"==typeof b?a({method:"GET",url:"api/magnets/search/"+b,params:{start:c||1,stop:d||30}}):void 0};return{create:b,latest:c,top:d,search:e}}]);
//# sourceMappingURL=main.min.js.map